#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–∂–∞—Ç–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ —Å–∞–π—Ç–∞ carnagemusic.com
# –î–∞—Ç–∞: 8 –∞–≤–≥—É—Å—Ç–∞ 2025

echo "üöÄ –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ carnagemusic.com..."

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
BACKUP_DIR="carnage_website_backup_full"
ARCHIVE_NAME="carnage_website_backup_$(date +%Y%m%d_%H%M%S).tar.gz"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ —Å —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–µ–π
if [ ! -d "$BACKUP_DIR" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ü–∞–ø–∫–∞ $BACKUP_DIR –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"
    exit 1
fi

echo "üìÅ –ü–∞–ø–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –Ω–∞–π–¥–µ–Ω–∞: $BACKUP_DIR"

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:"
echo "   –†–∞–∑–º–µ—Ä: $(du -sh $BACKUP_DIR | cut -f1)"
echo "   –§–∞–π–ª–æ–≤: $(find $BACKUP_DIR -type f | wc -l | tr -d ' ')"

# –°–æ–∑–¥–∞–µ–º –∞—Ä—Ö–∏–≤
echo "üóúÔ∏è  –°–æ–∑–¥–∞–Ω–∏–µ —Å–∂–∞—Ç–æ–≥–æ –∞—Ä—Ö–∏–≤–∞..."
tar -czf "$ARCHIVE_NAME" "$BACKUP_DIR"

if [ $? -eq 0 ]; then
    echo "‚úÖ –ê—Ä—Ö–∏–≤ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: $ARCHIVE_NAME"
    echo "üìÅ –†–∞–∑–º–µ—Ä –∞—Ä—Ö–∏–≤–∞: $(du -sh $ARCHIVE_NAME | cut -f1)"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –∞—Ä—Ö–∏–≤–∞
    echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∞—Ä—Ö–∏–≤–∞..."
    tar -tzf "$ARCHIVE_NAME" > /dev/null
    
    if [ $? -eq 0 ]; then
        echo "‚úÖ –ê—Ä—Ö–∏–≤ –ø—Ä–æ—à–µ–ª –ø—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏"
        echo ""
        echo "üéâ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ!"
        echo "üì¶ –§–∞–π–ª –∞—Ä—Ö–∏–≤–∞: $ARCHIVE_NAME"
    else
        echo "‚ùå –û—à–∏–±–∫–∞: –ê—Ä—Ö–∏–≤ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω!"
        exit 1
    fi
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞—Ä—Ö–∏–≤–∞!"
    exit 1
fi 